{% extends "core/base.html" %}
{% block content %}
    {% include "operation/includes/modal/modal_add_category_office.html" %}
    <input type="hidden" id="page_name" value="{{ title }}" />
    {% include "operation/includes/category_operation_inside.html" %}
    <section class="oper_account">
        <div class="oper_account_sort_wrap">
            <h3>Сортировка</h3>
            <div class = "oper_account_sort_bank" data-sort-operation="1">с ООО</div>
            <div class = "oper_account_sort_bank" data-sort-operation="2">с ИП</div>
            <div class = "oper_account_sort_bank" data-sort-operation="3">с $</div>
        </div>
        {% comment %} кнопкикатегории офис
        <button class="btn_add_category_oper_account" data-name="modal-add_category_oper_account" data-meta="oper_account" data-sub-cat="1" data-cat="Офис">+</button>
        <br>
        кнопкикатегории реклама
        <button class="btn_add_category_oper_account" data-name="modal-add_category_oper_account" data-meta="oper_account" data-sub-cat="2" data-cat="Реклама">+</button>
        <br>
        кнопкикатегории прочее
        <button class="btn_add_category_oper_account" data-name="modal-add_category_oper_account" data-meta="oper_account" data-sub-cat="3" data-cat="Прочее">+</button>
        <br>
        <br>  {% endcomment %}
        <div class="oper_account_wrapper">
            {% regroup category_operation by sub_categ__name as category_operation_list %}
            <div class="oper_account_category">
                {% for sub_categ in category_operation_list %}
                    {% comment %} <h3 class="">{{ sub_categ.grouper }}</h3> {% endcomment %}
                    {% for category in sub_categ.list %}
                        <!--заголовки категорий с месяцами -->
                        {% if forloop.first %}
                            <div class="oper_account_category_title">
                                <div class="oper_account_category_item oper_account_category_item_categ">
                                    <div class="oper_account_category_count">
                                        {% if forloop.counter < 10 %}0{% endif %}
                                        {{ forloop.counter }}.
                                    </div>
                                    <h3 class="">{{ sub_categ.grouper }}</h3>
                                    <button class="btn_add_category_oper_account"
                                            data-name="modal-add_category_oper_account"
                                            data-meta="oper_account"
                                            data-sub-cat="{{ sub_categ.grouper }}"
                                            data-cat="{{ sub_categ.grouper }}">+</button>
                                </div>
                                {% for month in month_names %}
                                    <div class="oper_account_category_item oper_account_category_item_month oper_account_item_column">
                                        <h3 class="">{{ month.name_month }} {{ data|date:"Y" }}</h3>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <!--заголовки категорий с закончился -->
                        <!--операции по месяцам  -->
                        <div class="oper_account_items">
                            <!--операции по месяцам  столбкш с названиями категой-->
                            <div class="oper_account_item_categ">
                                <div class="oper_account_subcateg_count">
                                    {% if forloop.counter < 10 %}0{% endif %}
                                    {{ forloop.counter }}.
                                </div>
                                <div class="oper_account_subcateg_name">{{ category.name }}</div>
                            </div>
                            <!--сами суммы операции  -->
                            {% for operation in dataset %}
                                {% if operation.category_operation_name == category.name and operation.year_now == year_now %}
                                    <div class="df_col">
                                        <div class="oper_account_item_month  oper_account_item_column">
                                            <div class="oper_account_item oper_account_item_column ">
                                                <div class='oper_account_item_num {% if operation.total == 0 %}oper_account_item_column_garay{% endif %}'>
                                                    {{ operation.total }} ₽
                                                    {% if operation.comments %}
                                                  
                                                        <div class="comment_operation comment_operation_oper">?</div>
                                                        <div class="comment_operation_hidden_wrap">
                                                            {% for commentr1 in operation.comments  %}
                                                                {% if commentr1 %}
                                                                    <div class="comment_operation_hidden">
                                                                        <div class="previous_operation_title">{{ commentr1.data|date:'j E Y' }} - {{ commentr1.sum }} ₽</div>
                                                                        <div class="previous_operation_comment">{{ commentr1.comment }}</div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            {% comment %} <h3 class="">{{ operation.month_name }} {{ data|date:"Y" }}</h3> {% endcomment %}
                                        </div>
                                        <div class="oper_account_item_month  oper_account_item_column">
                                            <h3 class="">{{ operation.month_name }} {{ data|date:"Y" }}</h3>
                                        </div>
                                    </div>
                                {% endif %}

                                
                            {% endfor %}

                        </div>
                        <!--операции по месяцам закончились -->
                        <!--тотал  -->
                        {% if forloop.last %}
                            <div class="oper_account_total_actual_year">
                                <div class="oper_account_category_title">
                                    <div class="oper_account_category_item oper_account_category_item_categ">
                                        <div class="oper_account_category_count">
                                            {% if forloop.counter < 10 %}0{% endif %}
                                            {{ forloop.counter }}.
                                        </div>
                                        <h3 class="">Итого</h3>
                                    </div>
                                    {% for operation_total in dataset %}
                                        {% if   operation_total.total_month_tag == 0 %}
                                            {% if   operation_total.sub_categ == sub_categ.grouper %}
                                                <div class="oper_account_item_month  oper_account_item_column oper_account_item_total">
                                                    <div class="oper_account_item oper_account_item_column">{{ operation_total.total_month }} ₽</div>
                                                    <h3 class="">{{ operation_total.month_name }} {{ data|date:"Y" }}</h3>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                        <!--тотал закончился -->
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
    </section>
{% endblock content %}
